name: ðŸ” Code Quality Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ðŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ðŸ“¦ Install Dependencies
      run: |
        if [ -f package-lock.json ]; then
          npm ci
        else
          npm install
        fi
        
    - name: ðŸ” Install TypeScript
      run: npm install -g typescript
      
    - name: âœ… TypeScript Type Check
      run: npm run typecheck
      
    - name: ðŸ“Š Project Statistics
      run: |
        echo "ðŸ“ˆ Project Statistics:"
        echo "ðŸ“ TypeScript files: $(find src -name '*.ts' | wc -l)"
        echo "ðŸ“„ Total lines of code: $(find src -name '*.ts' -exec wc -l {} + | tail -1 | awk '{print $1}')"
        echo "ðŸŽ¨ CSS files: $(find src -name '*.css' | wc -l)"
        echo "ðŸ“‹ Project size: $(du -sh . | awk '{print $1}')"
        
    - name: ðŸ§ª Build Test
      run: |
        chmod +x ./build.sh
        ./build.sh
        
    - name: ðŸ“¦ Bundle Analysis
      run: |
        echo "ðŸ“¦ Build Output Analysis:"
        if [ -d "dist" ]; then
          echo "âœ… Build successful"
          echo "ðŸ“ Dist size: $(du -sh dist | awk '{print $1}')"
          echo "ðŸ“ Generated files:"
          find dist -type f -name "*.js" -o -name "*.css" | sort
        else
          echo "âŒ Build failed - no dist directory"
          exit 1
        fi
        
    - name: ðŸ” Security Check
      run: |
        echo "ðŸ”’ Security Analysis:"
        # Check for potential security issues in package.json
        if command -v npm >/dev/null 2>&1; then
          npm audit --audit-level=moderate || echo "âš ï¸ Security vulnerabilities found"
        fi
        
    - name: ðŸ“Š Performance Hints
      run: |
        echo "âš¡ Performance Analysis:"
        echo "ðŸ“¦ Main bundle size:"
        if [ -f "dist/main.js" ]; then
          ls -lh dist/main.js | awk '{print "Main JS: " $5}'
        fi
        if [ -f "dist/styles/main.css" ]; then
          ls -lh dist/styles/main.css | awk '{print "Main CSS: " $5}'
        fi
        echo "ðŸŽ¯ Optimization suggestions:"
        echo "  - Use code splitting for large bundles (>250KB)"
        echo "  - Minimize CSS and JS in production"
        echo "  - Consider lazy loading for non-critical resources"

